(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["shopOrderDetail"],{"2d88":function(t,s,o){"use strict";var e=o("960f"),n=o.n(e);n.a},"3b2b":function(t,s,o){var e=o("7726"),n=o("5dbc"),i=o("86cc").f,a=o("9093").f,r=o("aae3"),u=o("0bfb"),c=e.RegExp,l=c,p=c.prototype,d=/a/g,h=/a/g,v=new c(d)!==d;if(o("9e1e")&&(!v||o("79e5")(function(){return h[o("2b4c")("match")]=!1,c(d)!=d||c(h)==h||"/a/i"!=c(d,"i")}))){c=function(t,s){var o=this instanceof c,e=r(t),i=void 0===s;return!o&&e&&t.constructor===c&&i?t:n(v?new l(e&&!i?t.source:t,s):l((e=t instanceof c)?t.source:t,e&&i?u.call(t):s),o?this:p,c)};for(var C=function(t){t in c||i(c,t,{configurable:!0,get:function(){return l[t]},set:function(s){l[t]=s}})},f=a(l),g=0;f.length>g;)C(f[g++]);p.constructor=c,c.prototype=p,o("2aba")(e,"RegExp",c)}o("7a56")("RegExp")},"589a":function(t,s,o){"use strict";o.r(s);var e=function(){var t=this,s=t.$createElement,o=t._self._c||s;return o("div",{staticClass:"shop-order-detail"},[o("div",{style:t.showPage&&t.couponList.length>0?"":"display:none;"},[o("div",{staticClass:"tip-box"},[t.isInCoupon&&t.showTip?o("div",{staticClass:"tip"},[t._v("\n\t\t\t\t感谢您的支持，请至超市出示二维码进行使用！"),o("span",{staticClass:"near",on:{click:t.lookNearMarket}},[t._v("查看附近超市"),o("span",{staticClass:"iconfont iconlist_right"})])]):t.isOutCoupon?o("div",{staticClass:"tip"},[t._v("\n\t\t\t\t该电子券需前往第三方平台出示或兑换使用，具体细则参考商品详情介绍\n\t\t\t")]):o("div",{staticClass:"tip"},[t._v("感谢您的支持，请前往线下商户出示券号或二维码使用！")])]),o("div",{staticClass:"order-detail clearfix",on:{click:t.goToDetail}},[o("div",{directives:[{name:"lazy",rawName:"v-lazy:background-image",value:t.orderInfo.img,expression:"orderInfo.img",arg:"background-image"}],staticClass:"left-icon"}),o("div",{staticClass:"right-content"},[o("div",{staticClass:"title"},[t._v(t._s(t.orderInfo.productName))]),o("div",{staticClass:"intro hiddenLine2"},[t._v(t._s(t.orderInfo.tips))])]),o("div",{staticClass:"right-icon"},[o("span",{staticClass:"price"},[t._v("￥"+t._s(t.orderInfo.price))]),o("span",{staticClass:"iconfont iconlist_right"})])]),o("div",{staticClass:"coupon"},[o("div",{staticClass:"title"},[o("span",{staticClass:"main"},[t._v(t._s(t.isInCoupon?t.couponType:t.outCouponType))]),t.isInCoupon?o("span",{staticClass:"total"},[t._v(t._s(t.valuableCouponList.length>0?"（"+t.valuableCouponList.length+"张可使用）":""))]):t._e()]),o("div",{staticClass:"valid-date"},[t._v("\n\t\t\t\t"+t._s(t.isInCoupon?"有效期至：":"有效时间：")+t._s(t.isInCoupon?t.couponList.length>0&&t.couponList[0].endTime?t.dateFormat(t.couponList[0].endTime,"yyyy-mm-dd hh:MM"):"":0==t.baseInfo.limitType?t.baseInfo.useTimeLimit:t.baseInfo.fixedLength+"天内有效")+"\n\t\t\t")]),t.valuableCouponList.length?o("div",{staticClass:"qrcode"},[t.isInCoupon?o("div",{staticClass:"title"},[t._v("向商家出示券号或二维码即可使用")]):t._e(),t.isOutCoupon?o("div",{staticClass:"title"},[t._v("向商家出示或前往三方平台兑换使用")]):t._e(),o("div",{staticClass:"qrcode-swiper"},[o("swiper",{staticClass:"swiper",attrs:{options:t.swiperOption}},t._l(t.valuableCouponList,function(s,e){return o("swiper-slide",{key:e},[o("div",{staticClass:"box"},[o("div",{staticClass:"box1"},[o("div",{staticClass:"img",style:{backgroundImage:"url("+(t.isInCoupon?s.couponUrl:s.couponQrPic)+")"},attrs:{"data-url":t.isInCoupon?s.couponUrl:s.couponQrPic}}),2!=s.contentType?o("div",{staticClass:"code"},[o("span",{staticClass:"first"},[t._v("券号：")]),o("span",{staticClass:"last"},[t._v(t._s(t.isInCoupon?s.couponCode:s.couponNo))])]):t._e()])])])}),1),t.valuableCouponList.length?o("div",{staticClass:"pagination"},[o("div",{staticClass:"dot"},[t._v("\n\t\t\t\t\t\t\t"+t._s(t.currentBannerIndex+1)+"/"+t._s(t.valuableCouponList.length)+"\n\t\t\t\t\t\t")])]):t._e()],1)]):t._e(),o("div",{directives:[{name:"show",rawName:"v-show",value:!0,expression:"true"}],staticClass:"code-info"},[t.valuableCouponList.length>0?[o("div",{directives:[{name:"show",rawName:"v-show",value:t.hasUsedCouponList.length>0,expression:"hasUsedCouponList.length>0"}],staticClass:"title"},[t._v("- 已使用代金券 -")]),o("div",{staticClass:"code-list"},[t._l(t.hasUsedCouponList,function(s,e){return[e<=2&&!t.lookMore||t.lookMore?o("div",{key:e,staticClass:"list"},[o("span",{staticClass:"first"},[t._v("券号：")]),o("span",{staticClass:"last",style:1==s.couponStatus&&{"text-decoration":"line-through"}},[t._v(t._s(s.couponCode))])]):t._e()]})],2),o("div",{directives:[{name:"show",rawName:"v-show",value:!t.lookMore&&t.hasUsedCouponList.length>3,expression:"!lookMore && hasUsedCouponList.length>3"}],staticClass:"title look-more",on:{click:function(s){t.lookMore=!0}}},[t._v(" 查看更多\n\t\t\t\t\t")]),o("div",{staticClass:"noToUse"},t._l(t.noToUseCouponList,function(s,e){return o("div",{key:e,staticClass:"item"},[o("div",{staticClass:"title"},[o("span",{staticClass:"main"},[t._v(t._s(t.couponStatusMap[s.couponStatus]))]),o("span",{staticClass:"total"},[t._v("（"+t._s(s.list&&s.list.length)+"张）")])]),o("div",{staticClass:"valid-date"},[t._v("有效期至："+t._s(s.endTime?t.dateFormat(t.couponList[0].endTime,"yyyy-mm-dd hh:MM"):"")+"\n\t\t\t\t\t\t\t")]),t._l(s.list,function(s,e){return o("div",{key:e,staticClass:"list"},[o("span",{staticClass:"first"},[t._v("券号：")]),o("span",{staticClass:"last"},[t._v(t._s(s))])])})],2)}),0)]:[o("div",{staticClass:"noToUse"},t._l(t.noToUseCouponList,function(s,e){return o("div",{key:e,staticClass:"item"},[o("div",{staticClass:"title"},[o("span",{staticClass:"main"},[t._v(t._s(t.couponStatusMap[s.couponStatus]))]),o("span",{staticClass:"total"},[t._v("（"+t._s(s.list&&s.list.length)+"张）")])]),o("div",{staticClass:"valid-date"},[t._v("有效期至："+t._s(s.endTime?t.dateFormat(t.couponList[0].endTime,"yyyy-mm-dd hh:MM"):"")+"\n\t\t\t\t\t\t\t")]),t._l(s.list,function(s,e){return o("div",{key:e,staticClass:"list"},[o("span",{staticClass:"first"},[t._v("券号：")]),o("span",{staticClass:"last"},[t._v(t._s(s))])])})],2)}),0)]],2),o("div",{directives:[{name:"show",rawName:"v-show",value:t.isOutCoupon,expression:"isOutCoupon"}],staticClass:"code-info"},[o("div",{staticClass:"code-list outCoupon"},[t._l(t.hasUsedCouponList,function(s,e){return[e<=2&&!t.lookMore||t.lookMore?o("div",{key:e,staticClass:"list"},[o("span",{staticClass:"first"},[t._v("券号：")]),o("span",{staticClass:"last"},[t._v(t._s(s.couponNo))])]):t._e()]})],2),o("div",{directives:[{name:"show",rawName:"v-show",value:!t.lookMore&&t.hasUsedCouponList.length>3,expression:"!lookMore && hasUsedCouponList.length>3"}],staticClass:"title look-more",on:{click:function(s){t.lookMore=!0}}},[t._v(" 查看更多\n\t\t\t\t")])])])]),t.showPage&&0==t.couponList.length?o("div",{staticClass:"empty"},[o("img",{attrs:{src:"http://hhh.images.visitshanghai.com.cn/coupons@3x.png"}}),o("div",{staticClass:"text"},[t._v(t._s(t.messageText))])]):t._e()])},n=[],i=o("ac2d"),a=(o("dfa4"),o("7212")),r=o("62a2"),u=o("f121"),c=o("ed08"),l=u["a"].MALL_URL,p=r["a"].dateFormat,d="blue",h="yshpre"===d?"1571833208084":"1571291931105",v="yshpre"===d?"1571833208011":"1571291931061",C={name:"shop-order-detail",data:function(){var t=this;return{couponStatusMap:{0:"未使用",1:"已使用",2:"已过期",3:"已失效",5:"退券中",6:"已退券"},dateFormat:p,orderId:this.$route.query.orderId,productId:this.$route.query.productId,orderInfo:{img:""},couponList:[],valuableCouponList:[],hasUsedCouponList:[],noToUseCouponList:{},currentBannerIndex:0,swiperOption:{slidesPerView:"auto",loopedSlides:2,loop:!1,on:{tap:function(t){},transitionEnd:function(s){1===this.progress?t.currentBannerIndex=t.valuableCouponList.length-1:t.currentBannerIndex=this.realIndex}}},lookMore:!1,token:"",showPage:!1,timer:null,messageText:"",baseInfo:{}}},computed:{couponType:function(){var t={1:"代金券",2:"折扣券",3:"套餐券"};return t[this.couponList.length>0?this.couponList[0].couponType:""]},outCouponType:function(){return this.couponList.length>0?this.couponList[0].typeNmae:""},showTip:function(){return this.orderInfo.skuId===h&&this.orderInfo.goodsId===v},isOutCoupon:function(){return 1*this.$route.query.productType===10},isInCoupon:function(){return 1*this.$route.query.productType===6||1*this.$route.query.productType===9}},created:function(){this.$uweb.trackEvent("查看商品二维码stu-shdx-chakanerweima","点击"),i["a"].setAppTitle({title:"订单详情"})},components:{swiper:a["swiper"],swiperSlide:a["swiperSlide"]},mounted:function(){var t=this;i["a"].sourceType()?(i["a"].noCallAppLoginGetInfo(function(s,o){t.token=o,t.token?t.queryUserOrder():i["a"].callAppLogin(function(){t.queryUserOrder()})}),i["a"].refreshPage(function(){i["a"].noCallAppLoginGetInfo(function(s,o){t.token=o,t.queryUserOrder()})})):this.queryUserOrder()},methods:{getData:function(){this.isInCoupon&&this.queryUserCoupon(),this.isOutCoupon&&this.queryOutCoupon()},lookNearMarket:function(){i["a"].openNewWebView({url:Object(c["d"])("/sports-list/market"),isFitWindow:!1})},goToDetail:function(){i["a"].openNewWebView({url:"".concat(l,"/#/goodsDetails/").concat(this.productId,"?innId=").concat(this.orderInfo.storeId),isFitWindow:!0})},queryUserCoupon:function(){var t=this,s={orderNo:this.orderId,productId:this.productId,pageNo:1,pageSize:20};this.$axios.member.queryUserCoupon(s).then(function(s){if(t.showPage=!0,s.result=s.result||{},t.couponList=s.result.item||[],t.valuableCouponList=t.couponList.filter(function(t){return"0"==t.couponStatus}),t.hasUsedCouponList=t.couponList.filter(function(t){return"1"==t.couponStatus}),t.valuableCouponList.length>0){var o=t.couponList.filter(function(t){return!("0"==t.couponStatus||"1"==t.couponStatus)});t.noToUseCouponList=t.parseData(o)}else{var e=t.couponList.filter(function(t){return"0"!=t.couponStatus});t.noToUseCouponList=t.parseData(e)}t.couponList.length>0&&(t.timer&&clearInterval(t.timer),t.timer=setInterval(function(){t.queryUserCoupon("loop")},1e4))}).catch(function(s){t.$toast({content:s.msg?s.msg:s,duration:2500})})},queryUserOrder:function(){var t=this,s={orderNo:this.orderId,productId:this.productId};this.$axios.member.queryUserOrder(s,{showLoading:!0}).then(function(s){null!=s.result?(t.orderInfo=s.result,t.getData()):(t.showPage=!0,t.messageText="暂无此商品")}).catch(function(s){t.$toast({content:s.message,duration:2500})})},queryOutCoupon:function(){var t=this;this.$axios.member.queryOutCoupon({orderNo:this.orderId}).then(function(s){t.showPage=!0,s.result=s.result||{},t.baseInfo=s.result.base||{},t.couponList=s.result.list||[],t.valuableCouponList=t.couponList.filter(function(t){return 2===+t.contentType||3===+t.contentType}),t.hasUsedCouponList=t.couponList.filter(function(t){return 1===+t.contentType}),t.couponList.length>0&&(t.timer&&clearTimeout(t.timer),t.timer=setTimeout(function(){t.queryOutCoupon("loop")},1e4))}).catch(function(s){t.showPage=!0,t.messageText=s.message?s.message:s.msg?s.msg:"暂无优惠券"})},parseData:function(t){for(var s={},o=0;o<t.length;o++)s[t[o].couponStatus]||(s[t[o].couponStatus]=t[o],s[t[o].couponStatus]["list"]=[]),s[t[o].couponStatus]["list"].push(t[o].couponCode);return s}}},f=C,g=(o("2d88"),o("2877")),m=Object(g["a"])(f,e,n,!1,null,"cfc61140",null);s["default"]=m.exports},"62a2":function(t,s,o){"use strict";o("456d"),o("ac6a"),o("3b2b"),o("a481");s["a"]={dateFormat:function(t,s){var o=new Date,e="日一二三四五六";t&&o.setTime(t),s=s||"yyyy-mm-dd";var n={"m+":o.getMonth()+1,"d+":o.getDate(),"w+":e.charAt(o.getDay()),"h+":o.getHours(),"M+":o.getMinutes(),"s+":o.getSeconds()};return/(y+)/.test(s)&&(s=s.replace(RegExp.$1,(o.getFullYear()+"").slice(-RegExp.$1.length))),Object.keys(n).forEach(function(t){new RegExp("(".concat(t,")")).test(s)&&(s=s.replace(RegExp.$1,1===RegExp.$1.length?n[t]:"00".concat(n[t]).slice((""+n[t]).length)))}),s}}},"960f":function(t,s,o){}}]);